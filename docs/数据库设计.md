# 数据库设计

## 组织架构相关表

### 1. 租户表 (tenants)
```sql
CREATE TABLE tenants (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(50) UNIQUE NOT NULL COMMENT '租户编码',
    name VARCHAR(100) NOT NULL COMMENT '租户名称',
    status TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```


### 3. 部门表 (departments)
```sql
CREATE TABLE departments (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_code VARCHAR(50) NOT NULL COMMENT '租户编码',
    code VARCHAR(50) NOT NULL COMMENT '部门编码',
    name VARCHAR(100) NOT NULL COMMENT '部门名称',
    parent_code VARCHAR(50) COMMENT '父部门编码',
    status TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_tenant_company_code` (tenant_code, company_code, code)
);
```

### 4. 岗位表 (positions)
```sql
CREATE TABLE positions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_code VARCHAR(50) NOT NULL COMMENT '租户编码',
    company_code VARCHAR(50) NOT NULL COMMENT '公司编码',
    department_code VARCHAR(50) NOT NULL COMMENT '部门编码',
    code VARCHAR(50) NOT NULL COMMENT '岗位编码',
    name VARCHAR(100) NOT NULL COMMENT '岗位名称',
    status TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_tenant_dept_code` (tenant_code, department_code, code)
);
```

## 权限体系相关表

### 1. 用户表 (users)
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_code VARCHAR(50) NOT NULL COMMENT '租户编码',
    username VARCHAR(50) NOT NULL COMMENT '用户名',
    password VARCHAR(255) NOT NULL COMMENT '密码',
    real_name VARCHAR(50) COMMENT '真实姓名',
    email VARCHAR(100) COMMENT '邮箱',
    phone VARCHAR(20) COMMENT '手机号',
    status TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_tenant_username` (tenant_code, username)
);
```

### 2. 用户岗位关联表 (user_positions)
```sql
CREATE TABLE user_positions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_code VARCHAR(50) NOT NULL COMMENT '租户编码',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    position_code VARCHAR(50) NOT NULL COMMENT '岗位编码',
    is_primary TINYINT DEFAULT 0 COMMENT '是否主岗：0-否 1-是',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_tenant_user_position` (tenant_code, user_id, position_code)
);
```

### 3. 角色表 (roles)
```sql
CREATE TABLE roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_code VARCHAR(50) NOT NULL COMMENT '租户编码',
    code VARCHAR(50) NOT NULL COMMENT '角色编码',
    name VARCHAR(100) NOT NULL COMMENT '角色名称',
    type TINYINT DEFAULT 1 COMMENT '角色类型：1-系统角色 2-租户角色',
    status TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_tenant_code` (tenant_code, code)
);
```

### 4. 用户角色关联表 (user_roles)
```sql
CREATE TABLE user_roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_code VARCHAR(50) NOT NULL COMMENT '租户编码',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    role_code VARCHAR(50) NOT NULL COMMENT '角色编码',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_tenant_user_role` (tenant_code, user_id, role_code)
);
```

### 5. 权限表 (permissions)
```sql
CREATE TABLE permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(50) NOT NULL COMMENT '权限编码',
    name VARCHAR(100) NOT NULL COMMENT '权限名称',
    type VARCHAR(20) NOT NULL COMMENT '权限类型：menu-菜单 button-按钮 api-接口',
    parent_code VARCHAR(50) COMMENT '父权限编码',
    path VARCHAR(200) COMMENT '权限路径',
    component VARCHAR(200) COMMENT '前端组件',
    perms VARCHAR(500) COMMENT '权限标识',
    icon VARCHAR(100) COMMENT '图标',
    sort INT DEFAULT 0 COMMENT '排序',
    status TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_code` (code)
);
```

### 6. 角色权限关联表 (role_permissions)
```sql
CREATE TABLE role_permissions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tenant_code VARCHAR(50) NOT NULL COMMENT '租户编码',
    role_code VARCHAR(50) NOT NULL COMMENT '角色编码',
    permission_code VARCHAR(50) NOT NULL COMMENT '权限编码',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY `uk_tenant_role_perm` (tenant_code, role_code, permission_code)
);
```

## 设计说明

1. 多租户隔离
   - 所有表都包含tenant_code字段，用于租户数据隔离
   - 关键字段都添加了租户级别的唯一索引

2. 组织架构
   - 采用公司-部门-岗位三级组织架构
   - 部门支持多级树形结构
   - 用户可以关联多个岗位，并标识主岗

3. 权限体系
   - 基于RBAC模型设计
   - 支持系统角色和租户角色
   - 权限支持菜单、按钮、接口三种类型
   - 权限表不带租户字段，实现权限定义的统一管理
   - 通过角色权限关联表实现租户级的权限分配